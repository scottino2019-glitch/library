<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Libreria Digitale</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Manteniamo PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <!-- Aggiungiamo epub.js -->
  <script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>
</head>
<body>
  <header>
    <h1>Libreria Digitale</h1>
    <nav>
      <!-- Qui il tuo login invariato -->
      <button id="loginBtn">Login</button>
    </nav>
  </header>

  <main>
    <section id="bookshelf">
      <!-- La tua griglia di libri rimane invariata -->
      <div class="book">
        <img src="cover1.jpg" alt="Libro 1"/>
        <div class="actions">
          <button class="pdf-open" data-file="libro1.pdf">Apri PDF</button>
          <button class="epub-open" data-file="libro1.epub">Apri EPUB</button>
        </div>
      </div>
      <!-- Aggiungi altri libri come giÃ  fai -->
    </section>
  </main>

  <!-- Viewer PDF invariato -->
  <div id="pdfViewer" class="modal hidden">
    <canvas id="pdfCanvas"></canvas>
    <button id="closePdf">Chiudi</button>
  </div>

  <!-- Viewer EPUB nuovo -->
  <div id="epubViewer" class="modal hidden">
    <div id="epubContainer" style="width:100%;height:100%;"></div>
    <button id="closeEpub">Chiudi</button>
  </div>

  <script>
    /* --- Login invariato --- */
    document.getElementById("loginBtn").addEventListener("click", () => {
      alert("Login invariato!");
    });

    /* --- PDF.js invariato --- */
    const pdfModal = document.getElementById("pdfViewer");
    const pdfCanvas = document.getElementById("pdfCanvas");
    const pdfCtx = pdfCanvas.getContext("2d");
    document.querySelectorAll(".pdf-open").forEach(btn => {
      btn.addEventListener("click", () => {
        const url = btn.dataset.file;
        pdfModal.classList.remove("hidden");
        pdfjsLib.getDocument(url).promise.then(pdf => {
          pdf.getPage(1).then(page => {
            const viewport = page.getViewport({scale:1.2});
            pdfCanvas.height = viewport.height;
            pdfCanvas.width = viewport.width;
            page.render({canvasContext: pdfCtx, viewport: viewport});
          });
        });
      });
    });
    document.getElementById("closePdf").addEventListener("click", () => {
      pdfModal.classList.add("hidden");
    });

    /* --- EPUB.js nuova gestione --- */
    const epubModal = document.getElementById("epubViewer");
    const epubContainer = document.getElementById("epubContainer");
    let currentBook = null;

    document.querySelectorAll(".epub-open").forEach(btn => {
      btn.addEventListener("click", () => {
        const url = btn.dataset.file;
        epubModal.classList.remove("hidden");
        epubContainer.innerHTML = ""; // pulizia
        currentBook = ePub(url);
        currentBook.renderTo(epubContainer, {
          width: "100%",
          height: "100%"
        });
        currentBook.ready.then(() => {
          currentBook.display();
        });
      });
    });

    document.getElementById("closeEpub").addEventListener("click", () => {
      epubModal.classList.add("hidden");
      epubContainer.innerHTML = "";
      if(currentBook){
        currentBook.destroy();
        currentBook = null;
      }
    });
  </script>
</body>
</html>
